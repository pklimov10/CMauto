insert [dbo].[DocDocumentTitlesId] ([documenttitle], [documenttitleid], [alias]) VALUES (N'Договор (контракт, соглашение)', 1, 1);
insert [dbo].[DocDocumentTitlesId] ([documenttitle], [documenttitleid], [alias]) VALUES (N'Карточка с образцами подписей и оттиска печати', 2, 2);
insert [dbo].[DocDocumentTitlesId] ([documenttitle], [documenttitleid], [alias]) VALUES (N'Банковское досье клиента', 3, 3);
insert [dbo].[DocDocumentTitlesId] ([documenttitle], [documenttitleid], [alias]) VALUES (N'Доверенность', 3, 3);
insert [dbo].[DocDocumentTitlesId] ([documenttitle], [documenttitleid], [alias]) VALUES (N'Заявление на открытие счета', 5, 5);
insert [dbo].[DocDocumentTitlesId] ([documenttitle], [documenttitleid], [alias]) VALUES (N'Сведения об использовании кредитной организацией интернет-технологий', 6, 6);
insert [dbo].[DocDocumentTitlesId] ([documenttitle], [documenttitleid], [alias]) VALUES (N'Паспорт гражданина РФ', 7, 7);
insert [dbo].[DocDocumentTitlesId] ([documenttitle], [documenttitleid], [alias]) VALUES (N'Сертификат ключа подписи', 8, 8);
insert [dbo].[DocDocumentTitlesId] ([documenttitle], [documenttitleid], [alias]) VALUES (N'Справка', 10, 10);
insert [dbo].[DocDocumentTitlesId] ([documenttitle], [documenttitleid], [alias]) VALUES (N'Акт приемки-сдачи работ (услуг)', 11, 11);
insert [dbo].[DocDocumentTitlesId] ([documenttitle], [documenttitleid], [alias]) VALUES (N'Кассовый чек', 12, 12);
insert [dbo].[DocDocumentTitlesId] ([documenttitle], [documenttitleid], [alias]) VALUES (N'Протокол', 13, 13);
insert [dbo].[DocDocumentTitlesId] ([documenttitle], [documenttitleid], [alias]) VALUES (N'Акт о приемке выполненных работ', 14, 14);
insert [dbo].[DocDocumentTitlesId] ([documenttitle], [documenttitleid], [alias]) VALUES (N'Пояснительная записка', 15, 15);
insert [dbo].[DocDocumentTitlesId] ([documenttitle], [documenttitleid], [alias]) VALUES (N'Спецификация', 16, 16);
insert [dbo].[DocDocumentTitlesId] ([documenttitle], [documenttitleid], [alias]) VALUES (N'Счет за период', 17, 17);
insert [dbo].[DocDocumentTitlesId] ([documenttitle], [documenttitleid], [alias]) VALUES (N'Счет-фактура за период', 18, 18);
insert [dbo].[DocDocumentTitlesId] ([documenttitle], [documenttitleid], [alias]) VALUES (N'Акт о зачете взаимных требований (взаимозачет)', 19, 19);
insert [dbo].[DocDocumentTitlesId] ([documenttitle], [documenttitleid], [alias]) VALUES (N'Приходный кассовый ордер', 20, 20);
insert [dbo].[DocDocumentTitlesId] ([documenttitle], [documenttitleid], [alias]) VALUES (N'Расходный кассовый ордер', 21, 21);
insert [dbo].[DocDocumentTitlesId] ([documenttitle], [documenttitleid], [alias]) VALUES (N'Платежное поручение за период, документы, подтверждающие оплату', 22, 22);
insert [dbo].[DocDocumentTitlesId] ([documenttitle], [documenttitleid], [alias]) VALUES (N'Товарная накладная', 23, 23);
insert [dbo].[DocDocumentTitlesId] ([documenttitle], [documenttitleid], [alias]) VALUES (N'Оборотно-сальдовая ведомость', 24, 24);
insert [dbo].[DocDocumentTitlesId] ([documenttitle], [documenttitleid], [alias]) VALUES (N'Карточки бухгалтерских счетов', 25, 25);
insert [dbo].[DocDocumentTitlesId] ([documenttitle], [documenttitleid], [alias]) VALUES (N'Документ о передаче результатов работ (об оказании услуг)', 26, 26);
insert [dbo].[DocDocumentTitlesId] ([documenttitle], [documenttitleid], [alias]) VALUES (N'Товарно-транспортная накладная', 27, 27);
insert [dbo].[DocDocumentTitlesId] ([documenttitle], [documenttitleid], [alias]) VALUES (N'Акт сверки расчетов с поставщиками (покупателями)', 28, 28);
insert [dbo].[DocDocumentTitlesId] ([documenttitle], [documenttitleid], [alias]) VALUES (N'Счет', 29, 29);
insert [dbo].[DocDocumentTitlesId] ([documenttitle], [documenttitleid], [alias]) VALUES (N'Объявление на взнос наличными', 30, 30);
insert [dbo].[DocDocumentTitlesId] ([documenttitle], [documenttitleid], [alias]) VALUES (N'Квитанция', 31, 31);
insert [dbo].[DocDocumentTitlesId] ([documenttitle], [documenttitleid], [alias]) VALUES (N'Распоряжение', 32, 32);
insert [dbo].[DocDocumentTitlesId] ([documenttitle], [documenttitleid], [alias]) VALUES (N'(нет в словаре)', 33, 33);
insert [dbo].[DocDocumentTitlesId] ([documenttitle], [documenttitleid], [alias]) VALUES (N'Документы, на основании которых, производились операции по выдаче денежных средств', 34, 34);
insert [dbo].[DocDocumentTitlesId] ([documenttitle], [documenttitleid], [alias]) VALUES (N'Платежное поручение за период', 35, 35);
insert [dbo].[DocDocumentTitlesId] ([documenttitle], [documenttitleid], [alias]) VALUES (N'Реестр счетов', 37, 37);
insert [dbo].[DocDocumentTitlesId] ([documenttitle], [documenttitleid], [alias]) VALUES (N'Лицевой счет', 38, 38);
insert [dbo].[DocDocumentTitlesId] ([documenttitle], [documenttitleid], [alias]) VALUES (N'Договоры купли-продажи векселей', 39, 39);
insert [dbo].[DocDocumentTitlesId] ([documenttitle], [documenttitleid], [alias]) VALUES (N'Платежные документы, подтверждающие оплату векселей', 40, 40);
insert [dbo].[DocDocumentTitlesId] ([documenttitle], [documenttitleid], [alias]) VALUES (N'Паспорт сделки', 41, 41);
insert [dbo].[DocDocumentTitlesId] ([documenttitle], [documenttitleid], [alias]) VALUES (N'Ведомость банковского контроля', 42, 42);
insert [dbo].[DocDocumentTitlesId] ([documenttitle], [documenttitleid], [alias]) VALUES (N'Заявление на открытие (закрытие) расчетных счетов', 43, 43);
insert [dbo].[DocDocumentTitlesId] ([documenttitle], [documenttitleid], [alias]) VALUES (N'Заявление на открытие расчетных счетов', 44, 44);
insert [dbo].[DocDocumentTitlesId] ([documenttitle], [documenttitleid], [alias]) VALUES (N'Заявление на закрытие расчетных счетов', 45, 45);
insert [dbo].[DocDocumentTitlesId] ([documenttitle], [documenttitleid], [alias]) VALUES (N'Анкета юридического лица', 46, 46);
insert [dbo].[DocDocumentTitlesId] ([documenttitle], [documenttitleid], [alias]) VALUES (N'Договор на обслуживание клиента', 47, 47);
insert [dbo].[DocDocumentTitlesId] ([documenttitle], [documenttitleid], [alias]) VALUES (N'Акт приема-передачи государственных ценных бумаг', 48, 48);
insert [dbo].[DocDocumentTitlesId] ([documenttitle], [documenttitleid], [alias]) VALUES (N'Сведения о поступлении денежных средств, их источниках и расходовании денежных средств', 49, 49);
insert [dbo].[DocDocumentTitlesId] ([documenttitle], [documenttitleid], [alias]) VALUES (N'Сведения о межбанковских кредитах и депозитах', 50, 50);
insert [dbo].[DocDocumentTitlesId] ([documenttitle], [documenttitleid], [alias]) VALUES (N'Копия карточек с образцами подписей и оттиском печати', 51, 51);
insert [dbo].[DocDocumentTitlesId] ([documenttitle], [documenttitleid], [alias]) VALUES (N'Дополнение к договору (контракту, соглашению)', 52, 52);
insert [dbo].[DocDocumentTitlesId] ([documenttitle], [documenttitleid], [alias]) VALUES (N'Платежное поручение', 53, 53);
insert [dbo].[DocDocumentTitlesId] ([documenttitle], [documenttitleid], [alias]) VALUES (N'Выписка из лицевого счета бюджета', 54, 54);
insert [dbo].[DocDocumentTitlesId] ([documenttitle], [documenttitleid], [alias]) VALUES (N'Сведения о финансовом состоянии организации', 55, 55);
insert [dbo].[DocDocumentTitlesId] ([documenttitle], [documenttitleid], [alias]) VALUES (N'Приказ по вопросам основной деятельности', 56, 56);
insert [dbo].[DocDocumentTitlesId] ([documenttitle], [documenttitleid], [alias]) VALUES (N'Договоры на размещение векселей', 57, 57);
insert [dbo].[DocDocumentTitlesId] ([documenttitle], [documenttitleid], [alias]) VALUES (N'Договор на открытие банковского счета', 58, 58);
insert [dbo].[DocDocumentTitlesId] ([documenttitle], [documenttitleid], [alias]) VALUES (N'Акт общей формы', 59, 59);
insert [dbo].[DocDocumentTitlesId] ([documenttitle], [documenttitleid], [alias]) VALUES (N'Выписки по лицевым счетам', 60, 60);
insert [dbo].[DocDocumentTitlesId] ([documenttitle], [documenttitleid], [alias]) VALUES (N'Выписку по счету', 61, 61);
insert [dbo].[DocDocumentTitlesId] ([documenttitle], [documenttitleid], [alias]) VALUES (N'Дополнительные соглашения к договорам займов', 62, 62);
insert [dbo].[DocDocumentTitlesId] ([documenttitle], [documenttitleid], [alias]) VALUES (N'Договоры и иные документы, подтверждающие погашение (частичное погашение) займов', 63, 63);
insert [dbo].[DocDocumentTitlesId] ([documenttitle], [documenttitleid], [alias]) VALUES (N'Карточка аналитического учета расчетов с дебиторами и кредиторами', 64, 64);
insert [dbo].[DocDocumentTitlesId] ([documenttitle], [documenttitleid], [alias]) VALUES (N'Акт о приеме-передаче основных средств', 65, 65);
insert [dbo].[DocDocumentTitlesId] ([documenttitle], [documenttitleid], [alias]) VALUES (N'Акт (иной документ), подтверждающий выполнение работ (оказание услуг)', 66, 66);
insert [dbo].[DocDocumentTitlesId] ([documenttitle], [documenttitleid], [alias]) VALUES (N'Платежный ордер', 67, 67)
insert [dbo].[DocDocumentTitlesId] ([documenttitle], [documenttitleid], [alias]) VALUES (N'Опись расчетных документов', 68, 68);
insert [dbo].[DocDocumentTitlesId] ([documenttitle], [documenttitleid], [alias]) VALUES (N'Журнал учета вызовов технических специалистов и выполненных работ', 69, 69);
insert [dbo].[DocDocumentTitlesId] ([documenttitle], [documenttitleid], [alias]) VALUES (N'Платежные документы', 70, 70);
insert [dbo].[DocDocumentTitlesId] ([documenttitle], [documenttitleid], [alias]) VALUES (N'Сведения о счетах клиентов и платежах, проведенных через кредитную организацию (ее филиал)', 71, 71);
insert [dbo].[DocDocumentTitlesId] ([documenttitle], [documenttitleid], [alias]) VALUES (N'Отчет о наличном денежном обороте', 72, 72);
insert [dbo].[DocDocumentTitlesId] ([documenttitle], [documenttitleid], [alias]) VALUES (N'Регистры налогового учета', 73, 73);
insert [dbo].[DocDocumentTitlesId] ([documenttitle], [documenttitleid], [alias]) VALUES (N'Денежные чеки (реестр выданных денежных чеков)', 75, 75);
insert [dbo].[DocDocumentTitlesId] ([documenttitle], [documenttitleid], [alias]) VALUES (N'Сведения о номерах денежных чековых книжек', 76, 76);
insert [dbo].[DocDocumentTitlesId] ([documenttitle], [documenttitleid], [alias]) VALUES (N'Сведения о получателях наличных денежных средств со счета (счетов)', 77, 77);
insert [dbo].[DocDocumentTitlesId] ([documenttitle], [documenttitleid], [alias]) VALUES (N'Информация об IР-адресах и МАС-адресах', 78, 78);
insert [dbo].[DocDocumentTitlesId] ([documenttitle], [documenttitleid], [alias]) VALUES (N'Сведения об IР-адресе', 79, 79);
insert [dbo].[DocDocumentTitlesId] ([documenttitle], [documenttitleid], [alias]) VALUES (N'Сведения о телефонном номере', 80, 80);
insert [dbo].[DocDocumentTitlesId] ([documenttitle], [documenttitleid], [alias]) VALUES (N'Приказы о наделении правом первой подписи банковских документов', 81, 81);
insert [dbo].[DocDocumentTitlesId] ([documenttitle], [documenttitleid], [alias]) VALUES (N'Приказы, подтверждающие полномочия лиц, указанных в банковской карточке', 82, 82);
insert [dbo].[DocDocumentTitlesId] ([documenttitle], [documenttitleid], [alias]) VALUES (N'Полный код ЭЦП должностных лиц организации', 83, 83);
insert [dbo].[DocDocumentTitlesId] ([documenttitle], [documenttitleid], [alias]) VALUES (N'Заявление на установку системы <Клиент-Банк>', 84, 84);
insert [dbo].[DocDocumentTitlesId] ([documenttitle], [documenttitleid], [alias]) VALUES (N'Доверенность о наделении правом первой подписи банковских документов', 85, 85);
insert [dbo].[DocDocumentTitlesId] ([documenttitle], [documenttitleid], [alias]) VALUES (N'Документы, которые подтверждают полномочия единоличного исполнительного органа организации', 86, 86);
insert [dbo].[DocDocumentTitlesId] ([documenttitle], [documenttitleid], [alias]) VALUES (N'Документы, подтверждающие полномочия единоличного исполнительного органа организации', 87, 87);
insert [dbo].[DocDocumentTitlesId] ([documenttitle], [documenttitleid], [alias]) VALUES (N'Акт приема-передачи', 88, 88);
insert [dbo].[DocDocumentTitlesId] ([documenttitle], [documenttitleid], [alias]) VALUES (N'Акт выполненных работ', 89, 89);
insert [dbo].[DocDocumentTitlesId] ([documenttitle], [documenttitleid], [alias]) VALUES (N'Чеки подтверждающих снятие наличных денежных средств с расчетных счетов', 90, 90);
insert [dbo].[DocDocumentTitlesId] ([documenttitle], [documenttitleid], [alias]) VALUES (N'Договор об обслуживании', 91, 91);
insert [dbo].[DocDocumentTitlesId] ([documenttitle], [documenttitleid], [alias]) VALUES (N'Банковское досье', 92, 92);
insert [dbo].[DocDocumentTitlesId] ([documenttitle], [documenttitleid], [alias]) VALUES (N'Договора подтверждающие наличие кредитных отношений с Банком', 93, 93);

--DocTitlesNonSt

insert [dbo].[DocTitlesNonSt] ([doctitlename], [doctitleid]) VALUES (N'Письмо',1);
insert [dbo].[DocTitlesNonSt] ([doctitlename], [doctitleid]) VALUES (N'Требования о представлении пояснений',2);
insert [dbo].[DocTitlesNonSt] ([doctitlename], [doctitleid]) VALUES (N'Уведомление',3);
insert [dbo].[DocTitlesNonSt] ([doctitlename], [doctitleid]) VALUES (N'Извещение',4);
insert [dbo].[DocTitlesNonSt] ([doctitlename], [doctitleid]) VALUES (N'Информационное письмо',5);
insert [dbo].[DocTitlesNonSt] ([doctitlename], [doctitleid]) VALUES (N'Сообщение',6);
insert [dbo].[DocTitlesNonSt] ([doctitlename], [doctitleid]) VALUES (N'Ответ на обращение',7);
insert [dbo].[DocTitlesNonSt] ([doctitlename], [doctitleid]) VALUES (N'Решение',8);
insert [dbo].[DocTitlesNonSt] ([doctitlename], [doctitleid]) VALUES (N'Запрос',9);
insert [dbo].[DocTitlesNonSt] ([doctitlename], [doctitleid]) VALUES (N'Требование об уплате',10);

----positions
insert [dbo].[positions] ([position]) VALUES (N'Требование об уплате',1);
insert [dbo].[positions] ([position]) VALUES (N'Заместитель начальника',2);
insert [dbo].[positions] ([position]) VALUES (N'Начальник',3);
insert [dbo].[positions] ([position]) VALUES (N'И.о. начальника',4);
insert [dbo].[positions] ([position]) VALUES (N'Старший государственный налоговый инспектор',4);
insert [dbo].[positions] ([position]) VALUES (N'Государственный налоговый инспектор',5);
insert [dbo].[positions] ([position]) VALUES (N'Начальник отдела',6);
insert [dbo].[positions] ([position]) VALUES (N'Советник государственной гражданской службы РФ 2 класса',7);
insert [dbo].[positions] ([position]) VALUES (N'Заместитель руководителя',8);

--Doer
insert [dbo].[doer] ([LastName], [id]) VALUES (N'Алёшечкина Викторовна',1);


SELECT
  cmi.msgid AS ID_СООБЩЕНИЯ,
  cr.name AS ИМЯ_МАРШРУТА,
  cr.description AS ОПИСАНИЕ_МАРШРУТА,
  ce.name AS ИМЯ_ОШИБКИ,
  ce.description AS ОПИСАНИЕ_ОШИБКИ,
  cms.name AS СТАТУС,
  cms.description AS ОПИСАНИЕ_СТАТУСА,
  cmi.created_date
FROM cmi_msg_in cmi
JOIN cl_exception ce ON ce.id = cmi.exception AND ce.id_type = cmi.exception_type
JOIN cmi_route cr ON cr.id = cmi.route AND cr.id_type = cmi.route_type
JOIN cl_msg_state cms ON cms.id = cmi.state AND cms.id_type = cmi.state_type
WHERE cmi.created_date::text BETWEEN (SELECT now()::DATE - 10000 || ' 00:00:00') AND (SELECT now()::DATE - 1 || ' 23:59:59')
and exception IS NOT NULL;



	and (extract(epoch from CURRENT_TIMESTAMP - cmi_msg_out.created_date)/3600)::Integer > 1

and exception IS NOT NULL;


ERROR:  operator does not exist: timestamp without time zone >= text
LINE 14: WHERE cmi.created_date BETWEEN (SELECT now()|| ' 00:00:00') ...



SELECT now() || ' 00:00:00'
SELECT
  cmi.msgid AS ID_СООБЩЕНИЯ,
  cr.name AS ИМЯ_МАРШРУТА,
  cr.description AS ОПИСАНИЕ_МАРШРУТА,
  ce.name AS ИМЯ_ОШИБКИ,
  ce.description AS ОПИСАНИЕ_ОШИБКИ,
  cms.name AS СТАТУС,
  cms.description AS ОПИСАНИЕ_СТАТУСА,
  cmi.created_date
FROM cmi_msg_in cmi
JOIN cl_exception ce ON ce.id = cmi.exception AND ce.id_type = cmi.exception_type
JOIN cmi_route cr ON cr.id = cmi.route AND cr.id_type = cmi.route_type
JOIN cl_msg_state cms ON cms.id = cmi.state AND cms.id_type = cmi.state_type
and exception IS NOT NULL;

SELECT
  count (cmi.msgid)
FROM cmi_msg_in cmi
JOIN cl_exception ce ON ce.id = cmi.exception AND ce.id_type = cmi.exception_type
JOIN cmi_route cr ON cr.id = cmi.route AND cr.id_type = cmi.route_type
JOIN cl_msg_state cms ON cms.id = cmi.state AND cms.id_type = cmi.state_type
and exception IS NOT NULL;